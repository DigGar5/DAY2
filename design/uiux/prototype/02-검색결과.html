<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>검색결과 - SmartPhone Store</title>
    <link rel="stylesheet" href="common.css">
    <style>
        .search-header {
            background: white;
            padding: var(--space-6) 0;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: var(--space-6);
        }

        .search-form {
            display: flex;
            gap: var(--space-3);
            max-width: 600px;
        }

        .search-input {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: var(--text-base);
        }

        .search-btn {
            padding: var(--space-3) var(--space-6);
            background: var(--primary-600);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: var(--font-medium);
            cursor: pointer;
        }

        .main-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: var(--space-8);
            align-items: start;
        }

        .filter-sidebar {
            position: sticky;
            top: 100px;
        }

        .filter-panel {
            background: white;
            border-radius: 12px;
            padding: var(--space-6);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: var(--space-6);
        }

        .filter-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-4);
            color: var(--gray-900);
        }

        .filter-section {
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--gray-200);
        }

        .filter-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .filter-section h3 {
            font-size: var(--text-base);
            font-weight: var(--font-medium);
            margin-bottom: var(--space-3);
            color: var(--gray-800);
        }

        .price-range {
            display: flex;
            gap: var(--space-2);
            align-items: center;
            margin-bottom: var(--space-3);
        }

        .price-input {
            flex: 1;
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: var(--text-sm);
        }

        .brand-filters {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }

        .checkbox-item label {
            font-size: var(--text-sm);
            color: var(--gray-700);
            cursor: pointer;
        }

        .stock-filter {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .results-section {
            background: white;
            border-radius: 12px;
            padding: var(--space-6);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
            flex-wrap: wrap;
            gap: var(--space-4);
        }

        .results-info {
            font-size: var(--text-base);
            color: var(--gray-700);
        }

        .results-info .keyword {
            font-weight: var(--font-semibold);
            color: var(--primary-600);
        }

        .results-info .count {
            font-weight: var(--font-semibold);
            color: var(--gray-900);
        }

        .sort-controls {
            display: flex;
            gap: var(--space-2);
        }

        .sort-btn {
            padding: var(--space-2) var(--space-4);
            border: 1px solid var(--gray-300);
            background: white;
            border-radius: 6px;
            font-size: var(--text-sm);
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-out);
        }

        .sort-btn.active {
            background: var(--primary-600);
            color: white;
            border-color: var(--primary-600);
        }

        .sort-btn:hover {
            border-color: var(--primary-500);
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }

        .filter-tag {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-1) var(--space-3);
            background: var(--primary-100);
            color: var(--primary-700);
            border-radius: 20px;
            font-size: var(--text-sm);
        }

        .filter-tag button {
            background: none;
            border: none;
            color: var(--primary-700);
            cursor: pointer;
            font-size: 14px;
            padding: 0;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-6);
        }

        .product-card-extended {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all var(--duration-normal) var(--ease-out);
            cursor: pointer;
            border: 2px solid transparent;
        }

        .product-card-extended:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
            border-color: var(--primary-200);
        }

        .product-image-wrapper {
            position: relative;
            height: 220px;
            overflow: hidden;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: var(--gray-100);
        }

        .product-badges {
            position: absolute;
            top: var(--space-3);
            left: var(--space-3);
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .stock-status {
            position: absolute;
            top: var(--space-3);
            right: var(--space-3);
            padding: var(--space-1) var(--space-2);
            border-radius: 4px;
            font-size: var(--text-xs);
            font-weight: var(--font-medium);
        }

        .stock-available {
            background: var(--success-100);
            color: var(--success-700);
        }

        .stock-unavailable {
            background: var(--error-100);
            color: var(--error-700);
        }

        .product-info-extended {
            padding: var(--space-5);
        }

        .product-brand {
            font-size: var(--text-sm);
            color: var(--gray-600);
            margin-bottom: var(--space-1);
        }

        .product-name {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--gray-900);
            margin-bottom: var(--space-3);
            line-height: var(--leading-tight);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-specs {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }

        .spec-item {
            font-size: var(--text-xs);
            color: var(--gray-600);
            background: var(--gray-100);
            padding: var(--space-1) var(--space-2);
            border-radius: 4px;
        }

        .product-price-section {
            margin-bottom: var(--space-4);
        }

        .product-price {
            font-family: var(--font-mono);
            font-size: var(--text-xl);
            font-weight: var(--font-bold);
            color: var(--gray-900);
        }

        .original-price {
            font-size: var(--text-sm);
            color: var(--gray-500);
            text-decoration: line-through;
            margin-left: var(--space-2);
        }

        .discount-rate {
            color: var(--error-600);
            font-weight: var(--font-semibold);
            margin-left: var(--space-2);
        }

        .product-score-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .score-display-small {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .score-circle-small {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: var(--gray-200);
        }

        .score-circle-small::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                var(--primary-500) 0deg,
                var(--primary-500) calc(var(--score, 0) * 3.6deg),
                transparent calc(var(--score, 0) * 3.6deg)
            );
        }

        .score-content-small {
            position: relative;
            z-index: 1;
            background: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .score-number-small {
            font-family: var(--font-mono);
            font-size: var(--text-sm);
            font-weight: var(--font-bold);
            color: var(--primary-700);
        }

        .score-details {
            text-align: right;
        }

        .score-grade {
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--gray-700);
        }

        .score-label {
            font-size: var(--text-xs);
            color: var(--gray-500);
        }

        .product-actions {
            display: flex;
            gap: var(--space-2);
        }

        .btn-cart {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            background: var(--primary-600);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-out);
        }

        .btn-cart:hover {
            background: var(--primary-700);
        }

        .btn-cart:disabled {
            background: var(--gray-400);
            cursor: not-allowed;
        }

        .btn-compare {
            padding: var(--space-3);
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-out);
        }

        .btn-compare:hover {
            border-color: var(--primary-500);
            color: var(--primary-600);
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: var(--space-2);
            margin-top: var(--space-8);
        }

        .page-btn {
            padding: var(--space-2) var(--space-4);
            border: 1px solid var(--gray-300);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: var(--text-sm);
            transition: all var(--duration-normal) var(--ease-out);
        }

        .page-btn.active {
            background: var(--primary-600);
            color: white;
            border-color: var(--primary-600);
        }

        .page-btn:hover:not(.active) {
            border-color: var(--primary-500);
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: var(--space-8);
        }

        .no-results {
            text-align: center;
            padding: var(--space-12);
            color: var(--gray-600);
        }

        .no-results-icon {
            font-size: 48px;
            margin-bottom: var(--space-4);
            color: var(--gray-400);
        }

        @media (max-width: 1023px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .filter-sidebar {
                order: -1;
                position: static;
            }

            .filter-panel {
                margin-bottom: var(--space-4);
            }

            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 767px) {
            .search-form {
                flex-direction: column;
            }

            .results-header {
                flex-direction: column;
                align-items: stretch;
                gap: var(--space-3);
            }

            .sort-controls {
                justify-content: center;
            }

            .product-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="01-메인대시보드.html" class="logo">📱 SmartPhone Store</a>
                <nav class="nav-menu">
                    <a href="02-검색결과.html">상품검색</a>
                    <a href="05-개인화추천.html">맞춤추천</a>
                    <a href="08-마이페이지.html">마이페이지</a>
                </nav>
                <div class="header-actions">
                    <a href="07-로그인.html" class="btn btn-outline btn-sm">로그인</a>
                    <a href="09-장바구니.html" class="btn btn-primary btn-sm">
                        장바구니 <span class="cart-count" style="display: none;">0</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <section class="search-header">
        <div class="container">
            <form class="search-form" id="searchForm">
                <input type="text" class="search-input" id="searchInput" placeholder="상품명, 브랜드, 모델명 검색" value="갤럭시">
                <button type="submit" class="search-btn">검색</button>
            </form>
        </div>
    </section>

    <main class="container">
        <div class="main-content">
            <aside class="filter-sidebar">
                <div class="filter-panel">
                    <h2 class="filter-title">필터</h2>

                    <div class="filter-section">
                        <h3>가격 범위</h3>
                        <div class="price-range">
                            <input type="number" class="price-input" placeholder="최소가격" id="minPrice">
                            <span>~</span>
                            <input type="number" class="price-input" placeholder="최대가격" id="maxPrice">
                        </div>
                    </div>

                    <div class="filter-section">
                        <h3>브랜드</h3>
                        <div class="brand-filters">
                            <div class="checkbox-item">
                                <input type="checkbox" id="samsung" value="삼성">
                                <label for="samsung">삼성 (4)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="apple" value="애플">
                                <label for="apple">애플 (2)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="lg" value="LG">
                                <label for="lg">LG (1)</label>
                            </div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <h3>성능</h3>
                        <div class="brand-filters">
                            <div class="checkbox-item">
                                <input type="checkbox" id="ram8" value="8GB+">
                                <label for="ram8">RAM 8GB 이상</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="storage128" value="128GB+">
                                <label for="storage128">저장용량 128GB 이상</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="display6" value="6인치+">
                                <label for="display6">화면 6인치 이상</label>
                            </div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <div class="stock-filter">
                            <input type="checkbox" id="inStockOnly" value="true">
                            <label for="inStockOnly">재고 있는 상품만 보기</label>
                        </div>
                    </div>

                    <button class="btn btn-primary" style="width: 100%;" onclick="applyFilters()">필터 적용</button>
                </div>
            </aside>

            <section class="results-section">
                <div class="results-header">
                    <div class="results-info">
                        '<span class="keyword" id="searchKeyword">갤럭시</span>' 검색결과
                        <span class="count" id="resultCount">4</span>개
                    </div>
                    <div class="sort-controls">
                        <button class="sort-btn active" onclick="sortResults('score')">가성비순</button>
                        <button class="sort-btn" onclick="sortResults('price_asc')">가격낮은순</button>
                        <button class="sort-btn" onclick="sortResults('price_desc')">가격높은순</button>
                        <button class="sort-btn" onclick="sortResults('popular')">인기순</button>
                    </div>
                </div>

                <div class="filter-tags" id="filterTags" style="display: none;">
                    <!-- 적용된 필터 태그들이 동적으로 추가됩니다 -->
                </div>

                <div class="product-grid" id="productGrid">
                    <!-- 상품 카드들이 동적으로 추가됩니다 -->
                </div>

                <div class="loading-spinner" id="loadingSpinner" style="display: none;">
                    <div class="loading"></div>
                </div>

                <div class="pagination" id="pagination">
                    <button class="page-btn">이전</button>
                    <button class="page-btn active">1</button>
                    <button class="page-btn">2</button>
                    <button class="page-btn">3</button>
                    <button class="page-btn">다음</button>
                </div>
            </section>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-links">
                    <div class="footer-section">
                        <h3>고객지원</h3>
                        <ul>
                            <li><a href="#">자주묻는질문</a></li>
                            <li><a href="#">1:1 문의</a></li>
                            <li><a href="#">배송조회</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h3>이용안내</h3>
                        <ul>
                            <li><a href="#">이용약관</a></li>
                            <li><a href="#">개인정보처리방침</a></li>
                            <li><a href="#">가성비 점수 안내</a></li>
                        </ul>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2024 SmartPhone Store. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="common.js"></script>
    <script>
        let currentFilters = {
            query: '갤럭시',
            sortBy: 'score',
            minPrice: null,
            maxPrice: null,
            brands: [],
            specs: [],
            inStockOnly: false
        };

        let currentResults = [];

        // 페이지 로드 시 초기 검색
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = Router.getParams();
            if (urlParams.q) {
                currentFilters.query = urlParams.q;
                document.getElementById('searchInput').value = urlParams.q;
                document.getElementById('searchKeyword').textContent = urlParams.q;
            }

            performSearch();
        });

        // 검색 폼 처리
        document.getElementById('searchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const query = document.getElementById('searchInput').value.trim();
            if (query) {
                currentFilters.query = query;
                document.getElementById('searchKeyword').textContent = query;
                performSearch();
            }
        });

        // 검색 실행
        async function performSearch() {
            showLoading(true);

            try {
                const result = await API.searchProducts(currentFilters.query, currentFilters);
                currentResults = result.products;
                displayResults(result.products);
                updateResultCount(result.total);
            } catch (error) {
                console.error('검색 오류:', error);
                Utils.showToast('검색 중 오류가 발생했습니다.', 'error');
            }

            showLoading(false);
        }

        // 결과 표시
        function displayResults(products) {
            const grid = document.getElementById('productGrid');

            if (products.length === 0) {
                grid.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">📱</div>
                        <h3>검색 결과가 없습니다</h3>
                        <p>다른 키워드로 검색해보세요</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = products.map(product => createProductCard(product)).join('');
        }

        // 상품 카드 생성
        function createProductCard(product) {
            const discountRate = product.originalPrice > product.price
                ? Utils.calculateDiscount(product.originalPrice, product.price)
                : 0;

            return `
                <div class="product-card-extended" onclick="goToProductDetail(${product.id})">
                    <div class="product-image-wrapper">
                        <img src="${product.image || '/api/placeholder/300/220'}"
                             alt="${product.name}"
                             class="product-image"
                             onerror="this.src='/api/placeholder/300/220'">
                        <div class="product-badges">
                            ${product.score >= 90 ? '<span class="badge badge-best">베스트</span>' : ''}
                            ${discountRate > 0 ? '<span class="badge badge-value">특가</span>' : ''}
                        </div>
                        <div class="stock-status ${product.inStock ? 'stock-available' : 'stock-unavailable'}">
                            ${product.inStock ? '재고있음' : '재고없음'}
                        </div>
                    </div>
                    <div class="product-info-extended">
                        <div class="product-brand">${product.brand}</div>
                        <h3 class="product-name">${product.name}</h3>
                        <div class="product-specs">
                            <span class="spec-item">${product.specs.display}</span>
                            <span class="spec-item">${product.specs.ram}</span>
                            <span class="spec-item">${product.specs.storage}</span>
                        </div>
                        <div class="product-price-section">
                            <span class="product-price">${Utils.formatPrice(product.price)}</span>
                            ${product.originalPrice > product.price ? `
                                <span class="original-price">${Utils.formatPrice(product.originalPrice)}</span>
                                <span class="discount-rate">${discountRate}%↓</span>
                            ` : ''}
                        </div>
                        <div class="product-score-section">
                            <div class="score-display-small">
                                <div class="score-circle-small" style="--score: ${product.score}">
                                    <div class="score-content-small">
                                        <span class="score-number-small">${product.score}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="score-details">
                                <div class="score-grade">${product.grade}</div>
                                <div class="score-label">가성비</div>
                            </div>
                        </div>
                        <div class="product-actions">
                            <button class="btn-cart ${!product.inStock ? 'disabled' : ''}"
                                    ${!product.inStock ? 'disabled' : ''}
                                    data-product-id="${product.id}"
                                    onclick="event.stopPropagation(); addToCart(${product.id})">
                                ${product.inStock ? '장바구니' : '품절'}
                            </button>
                            <button class="btn-compare" onclick="event.stopPropagation(); toggleCompare(${product.id})" title="비교하기">
                                ⚖️
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // 정렬 변경
        function sortResults(sortType) {
            // 정렬 버튼 활성화 상태 변경
            document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            currentFilters.sortBy = sortType;
            performSearch();
        }

        // 필터 적용
        function applyFilters() {
            // 가격 필터
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            currentFilters.minPrice = minPrice ? parseInt(minPrice) : null;
            currentFilters.maxPrice = maxPrice ? parseInt(maxPrice) : null;

            // 브랜드 필터
            const brandCheckboxes = document.querySelectorAll('[id^="samsung"], [id^="apple"], [id^="lg"]');
            currentFilters.brands = Array.from(brandCheckboxes)
                .filter(cb => cb.checked)
                .map(cb => cb.value);

            // 재고 필터
            currentFilters.inStockOnly = document.getElementById('inStockOnly').checked;

            // 필터 태그 업데이트
            updateFilterTags();

            // 검색 실행
            performSearch();
        }

        // 필터 태그 업데이트
        function updateFilterTags() {
            const container = document.getElementById('filterTags');
            const tags = [];

            if (currentFilters.minPrice || currentFilters.maxPrice) {
                const priceText = `${currentFilters.minPrice || 0}원 ~ ${currentFilters.maxPrice || '∞'}원`;
                tags.push({ text: priceText, type: 'price' });
            }

            currentFilters.brands.forEach(brand => {
                tags.push({ text: brand, type: 'brand', value: brand });
            });

            if (currentFilters.inStockOnly) {
                tags.push({ text: '재고있음', type: 'stock' });
            }

            if (tags.length > 0) {
                container.style.display = 'flex';
                container.innerHTML = tags.map(tag => `
                    <div class="filter-tag">
                        <span>${tag.text}</span>
                        <button onclick="removeFilter('${tag.type}', '${tag.value || ''}')">×</button>
                    </div>
                `).join('');
            } else {
                container.style.display = 'none';
            }
        }

        // 필터 제거
        function removeFilter(type, value) {
            switch (type) {
                case 'price':
                    currentFilters.minPrice = null;
                    currentFilters.maxPrice = null;
                    document.getElementById('minPrice').value = '';
                    document.getElementById('maxPrice').value = '';
                    break;
                case 'brand':
                    currentFilters.brands = currentFilters.brands.filter(b => b !== value);
                    document.querySelector(`input[value="${value}"]`).checked = false;
                    break;
                case 'stock':
                    currentFilters.inStockOnly = false;
                    document.getElementById('inStockOnly').checked = false;
                    break;
            }

            updateFilterTags();
            performSearch();
        }

        // 결과 개수 업데이트
        function updateResultCount(count) {
            document.getElementById('resultCount').textContent = count;
        }

        // 로딩 표시
        function showLoading(show) {
            document.getElementById('loadingSpinner').style.display = show ? 'flex' : 'none';
            document.getElementById('productGrid').style.display = show ? 'none' : 'grid';
        }

        // 상품 상세 페이지로 이동
        function goToProductDetail(productId) {
            Router.navigate('03-상품상세', { id: productId });
        }

        // 장바구니에 추가
        function addToCart(productId) {
            const product = SampleData.products.find(p => p.id === productId);
            if (product && product.inStock) {
                AppState.addToCart(product);
                Utils.showToast('장바구니에 추가되었습니다.', 'success');
            }
        }

        // 비교 기능 (향후 구현)
        function toggleCompare(productId) {
            Utils.showToast('상품 비교 기능은 곧 제공될 예정입니다.', 'info');
        }
    </script>
</body>
</html>