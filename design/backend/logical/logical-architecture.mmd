graph TB
    %% í´ë¼ì´ì–¸íŠ¸ ê³„ì¸µ
    Client[ğŸ–¥ï¸ Web/Mobile Client<br/>ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤]

    %% API Gateway - ë‹¨ì¼ ì§„ì…ì 
    Gateway[ğŸšª API Gateway<br/>â€¢ ë¼ìš°íŒ… & ë¡œë“œë°¸ëŸ°ì‹±<br/>â€¢ JWT ì¸ì¦<br/>â€¢ Rate Limiting<br/>â€¢ ë¡œê¹…]

    Client --> Gateway

    %% í•µì‹¬ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë“¤
    subgraph "í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ì„œë¹„ìŠ¤"
        UserSvc[ğŸ‘¤ User Service<br/>â€¢ íšŒì› ê°€ì…/ë¡œê·¸ì¸<br/>â€¢ ê°œì¸í™” ê°€ì¤‘ì¹˜ ì„¤ì •<br/>â€¢ ì‚¬ìš©ì í”„ë¡œí•„ ê´€ë¦¬]

        ProductSvc[ğŸ“± Product Service<br/>â€¢ ìƒí’ˆ ê²€ìƒ‰/í•„í„°ë§<br/>â€¢ ì‹¤ì‹œê°„ ì¬ê³  ê´€ë¦¬<br/>â€¢ ìƒí’ˆ ìƒì„¸ ì •ë³´]

        ScoreSvc[âš¡ Score Service<br/>CQRS íŒ¨í„´ ì ìš©<br/>â€¢ ê°€ì„±ë¹„ ì ìˆ˜ ê³„ì‚°<br/>â€¢ ì ìˆ˜ ìƒì„¸ ë¶„ì„<br/>â€¢ ì´ë ¥ ê´€ë¦¬]

        RecoSvc[ğŸ¯ Recommendation Service<br/>â€¢ ê°œì¸í™” ì¶”ì²œ<br/>â€¢ ì¶”ì²œ ê·¼ê±° ì œê³µ<br/>â€¢ ê³ ë“ì  í•„í„°ë§]

        OrderSvc[ğŸ›’ Order Service<br/>Saga íŒ¨í„´ ì ìš©<br/>â€¢ ì¥ë°”êµ¬ë‹ˆ ê´€ë¦¬<br/>â€¢ ì£¼ë¬¸/ê²°ì œ ì²˜ë¦¬<br/>â€¢ ì£¼ë¬¸ ë‚´ì—­ ê´€ë¦¬]

        FeedSvc[ğŸ“ Feedback Service<br/>â€¢ ë§Œì¡±ë„ ìˆ˜ì§‘<br/>â€¢ ê°œì„  ì œì•ˆ ë¶„ì„<br/>â€¢ ì•Œê³ ë¦¬ì¦˜ ê°œì„ ]
    end

    %% API Gatewayì—ì„œ ì„œë¹„ìŠ¤ë“¤ë¡œì˜ ì—°ê²°
    Gateway --> UserSvc
    Gateway --> ProductSvc
    Gateway --> ScoreSvc
    Gateway --> RecoSvc
    Gateway --> OrderSvc
    Gateway --> FeedSvc

    %% CQRS íŒ¨í„´ - Score Service ë‚´ë¶€ êµ¬ì¡°
    subgraph "Score Service CQRS êµ¬ì¡°"
        ScoreWrite[âš¡ Score Writer<br/>â€¢ ë³µì¡í•œ ê³„ì‚° ë¡œì§<br/>â€¢ ì™¸ë¶€ API í˜¸ì¶œ<br/>â€¢ ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘]

        ScoreRead[ğŸ“Š Score Reader<br/>â€¢ ìµœì í™”ëœ ì¡°íšŒ<br/>â€¢ ìºì‹œ í™œìš©<br/>â€¢ ì´ë ¥ ë°ì´í„° ê´€ë¦¬]
    end

    ScoreSvc --> ScoreWrite
    ScoreSvc --> ScoreRead

    %% Circuit Breaker íŒ¨í„´ - ì™¸ë¶€ API ë³´í˜¸
    subgraph "ì™¸ë¶€ API í†µí•© (Circuit Breaker)"
        CB[ğŸ›¡ï¸ Circuit Breaker<br/>â€¢ ì¥ì•  ê²©ë¦¬<br/>â€¢ Fallback ì²˜ë¦¬<br/>â€¢ ìë™ ë³µêµ¬]

        ExtPrice[ğŸ’° ê°€ê²© API<br/>ë‹¤ì¤‘ ì‡¼í•‘ëª°]
        ExtReview[â­ ë¦¬ë·° API<br/>í‰ì  ì‹œìŠ¤í…œ]
        ExtPerf[ğŸƒ ì„±ëŠ¥ API<br/>ë²¤ì¹˜ë§ˆí¬ DB]
    end

    ScoreWrite --> CB
    CB --> ExtPrice
    CB --> ExtReview
    CB --> ExtPerf

    %% ìºì‹œ ê³„ì¸µ (Cache-Aside íŒ¨í„´)
    Cache[(ğŸ—„ï¸ Redis Cache Cluster<br/>Cache-Aside íŒ¨í„´<br/>â€¢ ê°€ì„±ë¹„ ì ìˆ˜ (1ì‹œê°„)<br/>â€¢ ìƒí’ˆ ì •ë³´ (30ë¶„)<br/>â€¢ ì‚¬ìš©ì ì„¤ì • (24ì‹œê°„))]

    ProductSvc -.->|ìƒí’ˆ ìºì‹±| Cache
    ScoreRead -.->|ì ìˆ˜ ìºì‹±| Cache
    RecoSvc -.->|ì¶”ì²œ ìºì‹±| Cache
    UserSvc -.->|ì‚¬ìš©ì ì„¤ì • ìºì‹±| Cache

    %% ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜
    EventBus[ğŸ“¡ Event Bus<br/>Apache Kafka<br/>â€¢ ì¬ê³  ë³€ê²½ ì´ë²¤íŠ¸<br/>â€¢ ì£¼ë¬¸ ìƒíƒœ ë³€ê²½<br/>â€¢ ì ìˆ˜ ì—…ë°ì´íŠ¸ ì•Œë¦¼]

    ProductSvc -->|ì¬ê³  ë³€ê²½| EventBus
    ScoreWrite -->|ì ìˆ˜ ê³„ì‚° ì™„ë£Œ| EventBus
    OrderSvc -->|ì£¼ë¬¸ ìƒíƒœ ë³€ê²½| EventBus
    EventBus -->|ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸| RecoSvc
    EventBus -->|í”¼ë“œë°± ë¶„ì„| FeedSvc

    %% ë¹„ë™ê¸° ì²˜ë¦¬ í (Async Request-Reply)
    AsyncQueue[ğŸ“® Score Calculation Queue<br/>Async Request-Reply<br/>â€¢ 5ì´ˆ ì´ë‚´ ì‘ë‹µ ë³´ì¥<br/>â€¢ ì§„í–‰ ìƒíƒœ ì•Œë¦¼]

    Client -.->|ë¹„ë™ê¸° ì ìˆ˜ ìš”ì²­| AsyncQueue
    AsyncQueue -.->|ê³„ì‚° ìš”ì²­| ScoreWrite
    ScoreWrite -.->|ê³„ì‚° ì™„ë£Œ ì•Œë¦¼| Client

    %% ì„œë¹„ìŠ¤ ê°„ ë™ê¸° í˜¸ì¶œ
    RecoSvc -->|ê°œì¸í™” ì ìˆ˜ ìš”ì²­| ScoreRead
    RecoSvc -->|ì‚¬ìš©ì ê°€ì¤‘ì¹˜| UserSvc
    OrderSvc -->|ì¬ê³  í™•ì¸| ProductSvc
    ScoreWrite -->|ìƒí’ˆ ì •ë³´ ì¡°íšŒ| ProductSvc

    %% Saga íŒ¨í„´ - ì£¼ë¬¸ ì²˜ë¦¬
    subgraph "Order Saga Orchestrator"
        SagaOrch[ğŸ­ Saga Orchestrator<br/>â€¢ ë¶„ì‚° íŠ¸ëœì­ì…˜ ê´€ë¦¬<br/>â€¢ ë³´ìƒ íŠ¸ëœì­ì…˜<br/>â€¢ ìƒíƒœ ì¶”ì ]
        PaymentSvc[ğŸ’³ Payment Service<br/>â€¢ PG ì—°ë™<br/>â€¢ ê²°ì œ ì²˜ë¦¬<br/>â€¢ ê²°ì œ ì´ë ¥]
    end

    OrderSvc --> SagaOrch
    SagaOrch -->|ì¬ê³  í™•ì¸/ì°¨ê°| ProductSvc
    SagaOrch -->|ê²°ì œ ì²˜ë¦¬| PaymentSvc

    %% ë°ì´í„° ì €ì¥ì†Œ (Database per Service)
    subgraph "ë°ì´í„°ë² ì´ìŠ¤ ê³„ì¸µ"
        UserDB[(ğŸ‘¤ User Database<br/>PostgreSQL<br/>â€¢ ì‚¬ìš©ì ì •ë³´<br/>â€¢ ê°œì¸í™” ì„¤ì •)]

        ProductDB[(ğŸ“± Product Database<br/>PostgreSQL<br/>â€¢ ìƒí’ˆ ì¹´íƒˆë¡œê·¸<br/>â€¢ ì¬ê³  ì •ë³´<br/>â€¢ ê²€ìƒ‰ ì¸ë±ìŠ¤)]

        ScoreWriteDB[(âš¡ Score Write DB<br/>PostgreSQL<br/>â€¢ ê³„ì‚° ë¡œì§<br/>â€¢ ì›ì‹œ ë°ì´í„°)]

        ScoreReadDB[(ğŸ“Š Score Read DB<br/>MongoDB<br/>â€¢ ìµœì í™”ëœ ì¡°íšŒ<br/>â€¢ ì ìˆ˜ ì´ë ¥)]

        OrderDB[(ğŸ›’ Order Database<br/>PostgreSQL<br/>â€¢ ì£¼ë¬¸ ì •ë³´<br/>â€¢ ê²°ì œ ì´ë ¥<br/>â€¢ ë°°ì†¡ ìƒíƒœ)]

        FeedDB[(ğŸ“ Feedback Database<br/>PostgreSQL<br/>â€¢ ì‚¬ìš©ì í”¼ë“œë°±<br/>â€¢ ë¶„ì„ ê²°ê³¼)]
    end

    %% ì„œë¹„ìŠ¤ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
    UserSvc --> UserDB
    ProductSvc --> ProductDB
    ScoreWrite --> ScoreWriteDB
    ScoreRead --> ScoreReadDB
    OrderSvc --> OrderDB
    PaymentSvc --> OrderDB
    FeedSvc --> FeedDB

    %% ëª¨ë‹ˆí„°ë§ ë° ê´€ì°°ì„±
    Monitor[ğŸ“ˆ Monitoring & Observability<br/>â€¢ Prometheus/Grafana<br/>â€¢ ELK Stack<br/>â€¢ Jaeger ë¶„ì‚° ì¶”ì <br/>â€¢ ì„±ëŠ¥ ì•Œë¦¼]

    Gateway -.->|ë©”íŠ¸ë¦­ ìˆ˜ì§‘| Monitor
    CB -.->|Circuit Breaker ìƒíƒœ| Monitor
    Cache -.->|ìºì‹œ íˆíŠ¸ìœ¨| Monitor
    ScoreWrite -.->|ê³„ì‚° ì‹œê°„ ì¶”ì | Monitor

    %% ìŠ¤íƒ€ì¼ ì •ì˜
    classDef service fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000
    classDef database fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
    classDef pattern fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,color:#000
    classDef external fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    classDef client fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000
    classDef async fill:#f1f8e9,stroke:#558b2f,stroke-width:2px,color:#000

    %% ìŠ¤íƒ€ì¼ ì ìš©
    class UserSvc,ProductSvc,ScoreSvc,RecoSvc,OrderSvc,FeedSvc,PaymentSvc,ScoreWrite,ScoreRead service
    class UserDB,ProductDB,ScoreWriteDB,ScoreReadDB,OrderDB,FeedDB database
    class Gateway,CB,Cache,EventBus,SagaOrch pattern
    class ExtPrice,ExtReview,ExtPerf external
    class Client client
    class AsyncQueue async
    class Monitor pattern